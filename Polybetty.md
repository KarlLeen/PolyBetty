---
# Telegram 社交投机机器人

这是一个基于区块链的Telegram投注机器人项目，集成了Monad测试网。用户可以通过Telegram创建投注、使用内联键盘选择投注选项，并在Monad测试网上结算结果。

---

## 团队信息

* **成员1:** 邮箱: limlamleen@gmail.com
* **成员2:** 邮箱: fuhaojava@foxmail.com 
---

## 项目描述

https://github.com/KarlLeen/PolyBetty

本项目旨在创建一个**去中心化、无摩擦的社交投注体验**。核心逻辑是让Telegram用户能够像在群聊中讨论一样，直接通过机器人**发起和参与各种预测投注**。当有人发起一个投注后，其他参与者可以通过**直观的内联键盘**选择他们的选项并下注测试网 USDC。投注结果由创建者（或未来由预言机）解决后，赢家可以领取奖金。所有投注记录和资金流转都透明地发生在 **Monad 测试网**上，保证了去中心化和可验证性。

---

## 可用的在线演示链接

**链接:** @PolyBetty_bot(请替换为你的Telegram机器人用户名链接)

---

## 所有部署在Monad Testnet的合约地址

* **SidebetFactory:** `0xd1c8997F8C6BCc88A9Cef2B6c0cbFdBAd0F7E89` (用途: 用于部署新的Sidebet投注合约)
* **Sidebet:** `0xd1c8997F8C6BCc88A9Cef2B6c0cbFdBAd0F7E89` (用途: 示例投注合约，处理资金和投注逻辑。请列出几个你用于演示的已部署投注合约地址)


---

## (可选) 视频

**链接:** https://drive.google.com/file/d/1gTUof86Bod_fZPuE4bONtMJ6eDrLbXQL/view?usp=sharing

---

## 功能

* **`/start`**: 欢迎用户，提供基本介绍和使用指南。
* **`/createbet`**: 创建新的投注。机器人将自动显示具有视觉吸引力的投注摘要，并为其他用户生成内联选项按钮。
* **`/joinbet`**: 加入现有投注。用户可以通过点击内联键盘按钮直接选择投注选项和预设金额，也可手动输入自定义金额。
* **`/resolvebet`**: 解决投注。仅限投注创建者操作，用于设置获胜选项。
* **`/betinfo`**: 查询指定投注的详细信息，包括状态、总金额、选项等，并以美观的格式呈现。
* **`/claimwinnings`**: 获胜者领取投注奖金。

### 特色功能

* **内联键盘交互**: 用户无需手动输入复杂的命令和参数，直接点击按钮即可选择投注选项和预设金额，极大提升操作便捷性。
* **视觉引人入胜的投注摘要**: 消息输出采用丰富的 **MarkdownV2 格式和表情符号**，使投注信息更直观、更具吸引力。
* **Monad 测试网集成**: 项目的核心逻辑部署在 Monad 测试网上，展示了在高性能 EVM 兼容链上进行去中心化社交投注的可能性。
* **测试模式**: 机器人可在特定测试环境下运行，模拟区块链交互，方便开发和演示时绕过部分真实代币限制。

---

## 技术栈

* **Telegram Bot**: `grammY` (TypeScript) - 提供强大的机器人框架，支持内联键盘和高级消息格式化，确保流畅的用户体验。
* **后端服务**: `Fastify` (Node.js/TypeScript) - 构建高性能的 RESTful API，作为 Telegram 机器人与区块链智能合约之间的桥梁，并支持测试模式。
* **智能合约**: `Solidity` - 核心投注逻辑通过智能合约实现，部署在 Monad 测试网上，确保投注过程的透明性和公平性。
* **区块链交互**: `ethers.js` - 用于后端服务与 Monad 测试网进行可靠的交互，包括发送交易、查询数据等。
* **样式**: 广泛利用 Telegram 的 MarkdownV2 格式和表情符号，显著提升用户界面的视觉吸引力和信息清晰度。

---

## 项目结构

```
bet/
├── src/
│   ├── bot/          # Telegram 机器人模块：处理用户命令和消息交互
│   ├── api/          # Fastify 后端服务模块：提供 RESTful API，处理业务逻辑
│   ├── blockchain/   # 区块链相关代码：封装 ethers.js 调用和智能合约交互
│   └── shared/       # 共享模块：存放跨模块的类型定义、常量等
└── test/            # 测试目录：包含单元测试和端到端测试脚本
```

---

## 安装与运行

请确保您已安装 Node.js 和 npm。

1.  **安装依赖**
    ```bash
    npm install
    ```

2.  **配置环境变量**
    复制示例配置文件，并根据你的环境填写必要配置，包括 Telegram Bot Token、Monad 测试网 RPC URL、部署者私钥、Test USDC 地址等。
    ```bash
    cp .env.example .env
    # 编辑 .env 文件填写必要配置
    ```

3.  **编译智能合约**
    这将编译 `Sidebet.sol` 合约并生成 ABI/Bytecode 文件。
    ```bash
    npm run compile:contracts
    ```

4.  **开发模式运行**
    分两个终端分别启动后端和机器人。
    ```bash
    # 终端 1: 启动 API 后端服务
    npm run dev:api

    # 终端 2: 启动 Telegram 机器人
    npm run dev:bot
    ```

5.  **生产模式运行**
    首先构建项目，然后启动各服务。
    ```bash
    npm run build
    npm run start:api
    npm run start:bot
    ```

---

## 用户体验优化

本项目特别注重用户体验，通过以下方面进行了优化：

1.  **内联键盘交互**
    * **一键选择**: 用户点击投注选项按钮即可直接开始加入投注。
    * **金额预设**: 提供预设金额按钮，简化用户下注流程。
    * **快速查询**: 通过消息中的按钮快速访问投注详情。

2.  **视觉增强**
    * **表情符号**: 广泛使用表情符号直观表示投注状态（如 🎉, 💰, ⏳, ✅）和选项编号（如 1️⃣, 2️⃣），提升信息可读性。
    * **结构化显示**: 采用分隔线和 Markdown 格式，使复杂信息（如投注摘要）更清晰、易于理解。

3.  **错误处理**
    * **一致性**: 所有错误消息都使用一致的格式和表情符号，提高用户对错误的认知和理解。
    * **精确验证**: 改进的验证流程确保提供准确的错误信息，帮助用户快速定位问题。
    * **功能修复**: 最近修复了“解决投注”功能中的潜在问题，提升了系统的稳定性。

---

## Monad 测试网集成

本项目已与 Monad 测试网深度集成，提供了以下关键特性：

1.  **智能合约部署**
    * 所有的核心投注合约 (`Sidebet.sol`) 均已成功部署并运行在 Monad 测试网上。
    * 支持使用 Monad 测试网上的模拟 USDC 代币进行下注，确保端到端流程的完整性。

2.  **区块链交互优化**
    * 实现了自动设置 `gas` 限制的机制，有效解决了在 Monad 测试网环境下 `gas` 估算不准确的问题，提高了交易成功率。
    * 完善了区块链交互的错误处理和日志记录，便于问题诊断和系统维护。

3.  **测试模式**
    * 为了方便开发和演示，项目支持在测试环境下模拟投注操作，允许在无需真实区块链交互的情况下测试机器人功能。

---

## 版本历史

### v1.1.0

* **内联键盘功能**: 实现了投注选项和金额选择的内联键盘交互。
* **信息显示增强**: 大幅提升了消息输出的视觉效果，使用了更多表情符号和格式化文本。
* **功能修复**: 修复了“解决投注”功能中存在的问题，提高了稳定性。
* **用户交互流程优化**: 改进了整体的用户操作流程，使其更加流畅和直观。

### v1.0.0

* **初始版本**: 项目的基础框架搭建完成。
* **核心功能实现**: 实现了基本的投注创建和参与功能，验证了端到端流程的可行性。

---

## **重要提示：**

* 所有合约内容都已部署在 **Monad Testnet** 上。
* 我已将最终版本的代码合并到此 PR 的分支中，准备合入当前仓库。
* 我确认代码将按照 `/root/yourproject` 的路径结构进行合并 (如果您的实际路径不同，请在此处修改)。
* **在线演示链接可用并且已经过充分测试。**
